"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.handler = void 0;
const client_lex_runtime_v2_1 = require("@aws-sdk/client-lex-runtime-v2");
const DialogHelpers = require("../../src/sharedLibraries/DialogHelpers");
const CommonUtils = require("../../src/sharedLibraries/CommonUtils");
const TIME_SLOT = "Time";
const TIME_SLOT_PROMPT_CODE_HOOK_LABEL = "CallIntent_TimeSlot_PromptCodeHook";
const TIME_SLOT_VALIDATION_CODE_HOOK_LABEL = "CallIntent_TimeSlot_ValidationCodeHook";
function handler(event) {
    let response = DialogHelpers.passThrough(event);
    const intent = event.sessionState.intent;
    // @ts-ignore intent will never be undefined in the Intent Handler
    if (intent.name !== "CallIntent" /* IntentNames.CALL_INTENT */) {
        console.error(`Wrong handler for intent called, current intent is ${intent}`);
        // Decide how you would like to handle this with the least disruption to your user
        return response;
    }
    /**
     * Determine the correct logic to run based on what code hook the request has come from
     */
    if (event.invocationSource === "DialogCodeHook" /* InvocationSource.DIALOG_CODE_HOOK */) {
        if (event.invocationLabel === TIME_SLOT_PROMPT_CODE_HOOK_LABEL) {
            // Check the user input, so we can adjust the prompt for ambiguous or time period values
            response = checkUserInput(event);
        }
        else if (event.invocationLabel === TIME_SLOT_VALIDATION_CODE_HOOK_LABEL) {
            // final validation on slot
            response = validateTimeSlot(event);
        }
    }
    else if (event.invocationSource === "FulfillmentCodeHook" /* InvocationSource.FULFILLMENT_CODE_HOOK */) {
        // book the call
        response = fulfilIntent(event);
    }
    return response;
}
exports.handler = handler;
/**
 * For Fulfillment, we will take action on book the call and then send a
 *  response with State of Fulfilled and a DialogAction of CLOSE
 */
const fulfilIntent = (event) => {
    // ****************************
    // ADD LOGIC HERE TO ACTUALLY BOOK THE CALL ....
    //
    // IN THE REAL WORLD WE WOULD BE REACHING OUT TO EXTERNAL SYSTEMS HERE
    // FOR NOW WE'RE JUST GOING TO RESPOND AS IF WE DID BOOK THE CALL
    // *****************************
    const time = CommonUtils.getSessionStateSlotValue(event, TIME_SLOT).interpretedValue;
    return DialogHelpers.fulfillIntent(event.sessionState, event.requestAttributes || {}, [
        {
            contentType: client_lex_runtime_v2_1.MessageContentType.PLAIN_TEXT,
            content: `Your call has been scheduled for ${time}`,
        },
    ]);
};
const validateTimeSlot = (event) => {
    // ****************************
    // LOGIC COULD BE ADDED HERE TO CHECK THIS TIME IS AVAILABLE BY REACHING OUT TO OUR BOOKING SYSTEM
    // THIS WOULD ALLOW US TO RE-PROMPT THE USER FOR A NEW TIME IF NEEDED
    // ****************************
    return DialogHelpers.passThrough(event);
};
/**
 * On each elicitation within the Time Slot we will do the following:
 * - If the slot is NOT filled we will check if there is more than one resolved value
 *     - If there is more than one, we will use those to ask the user to clarify with one
 *     - Else we will just delegate back to Lex
 */
const checkUserInput = (event) => {
    return checkForAmbiguousTimeSlotValue(event);
};
const isAmbiguousSlotValue = (slot) => {
    return slot && slot.resolvedValues && slot.resolvedValues.length > 1;
};
const checkForAmbiguousTimeSlotValue = (event) => {
    const timeSlotValue = CommonUtils.getSessionStateSlotValue(event, TIME_SLOT);
    if (isAmbiguousSlotValue(timeSlotValue)) {
        return askForTimeClarification(timeSlotValue.resolvedValues, event);
    }
    else {
        return DialogHelpers.passThrough(event);
    }
};
const askForTimeClarification = (resolvedValues, event) => {
    // concatenate the resolved values with 'or' between them
    const resolvedValuesString = resolvedValues.join(" or ");
    // set the next step to a re-prompt for the slot
    return DialogHelpers.promptForSlot(event.sessionState, event.requestAttributes || {}, TIME_SLOT, event.sessionState.intent, [
        {
            contentType: client_lex_runtime_v2_1.MessageContentType.PLAIN_TEXT,
            content: `Would you like ${resolvedValuesString}?`,
        },
    ]);
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2FsbEludGVudEhhbmRsZXItdjMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJjYWxsSW50ZW50SGFuZGxlci12My50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7QUFDQSwwRUFBMEU7QUFHMUUsTUFBTSxhQUFhLEdBQUcsT0FBTyxDQUFDLHlDQUF5QyxDQUFDLENBQUE7QUFDeEUsTUFBTSxXQUFXLEdBQUcsT0FBTyxDQUFDLHVDQUF1QyxDQUFDLENBQUE7QUFFcEUsTUFBTSxTQUFTLEdBQUcsTUFBTSxDQUFBO0FBRXhCLE1BQU0sZ0NBQWdDLEdBQUcsb0NBQW9DLENBQUE7QUFDN0UsTUFBTSxvQ0FBb0MsR0FBRyx3Q0FBd0MsQ0FBQTtBQUVyRixTQUFnQixPQUFPLENBQUMsS0FBNEI7SUFDbEQsSUFBSSxRQUFRLEdBQUcsYUFBYSxDQUFDLFdBQVcsQ0FBQyxLQUFLLENBQUMsQ0FBQTtJQUMvQyxNQUFNLE1BQU0sR0FBRyxLQUFLLENBQUMsWUFBWSxDQUFDLE1BQU0sQ0FBQTtJQUV4QyxrRUFBa0U7SUFDbEUsSUFBSSxNQUFNLENBQUMsSUFBSSwrQ0FBNEIsRUFBRTtRQUMzQyxPQUFPLENBQUMsS0FBSyxDQUFDLHNEQUFzRCxNQUFNLEVBQUUsQ0FBQyxDQUFBO1FBQzdFLGtGQUFrRjtRQUNsRixPQUFPLFFBQVEsQ0FBQTtLQUNoQjtJQUVEOztPQUVHO0lBQ0gsSUFBSSxLQUFLLENBQUMsZ0JBQWdCLDZEQUFzQyxFQUFFO1FBQ2hFLElBQUksS0FBSyxDQUFDLGVBQWUsS0FBSyxnQ0FBZ0MsRUFBRTtZQUM5RCx3RkFBd0Y7WUFDeEYsUUFBUSxHQUFHLGNBQWMsQ0FBQyxLQUFLLENBQUMsQ0FBQTtTQUNqQzthQUFNLElBQUksS0FBSyxDQUFDLGVBQWUsS0FBSyxvQ0FBb0MsRUFBRTtZQUN6RSwyQkFBMkI7WUFDM0IsUUFBUSxHQUFHLGdCQUFnQixDQUFDLEtBQUssQ0FBQyxDQUFBO1NBQ25DO0tBQ0Y7U0FBTSxJQUFJLEtBQUssQ0FBQyxnQkFBZ0IsdUVBQTJDLEVBQUU7UUFDNUUsZ0JBQWdCO1FBQ2hCLFFBQVEsR0FBRyxZQUFZLENBQUMsS0FBSyxDQUFDLENBQUE7S0FDL0I7SUFFRCxPQUFPLFFBQVEsQ0FBQTtBQUNqQixDQUFDO0FBNUJELDBCQTRCQztBQUVEOzs7R0FHRztBQUNILE1BQU0sWUFBWSxHQUFHLENBQUMsS0FBNEIsRUFBRSxFQUFFO0lBQ3BELCtCQUErQjtJQUMvQixnREFBZ0Q7SUFDaEQsRUFBRTtJQUNGLHNFQUFzRTtJQUN0RSxpRUFBaUU7SUFDakUsZ0NBQWdDO0lBRWhDLE1BQU0sSUFBSSxHQUFHLFdBQVcsQ0FBQyx3QkFBd0IsQ0FBQyxLQUFLLEVBQUUsU0FBUyxDQUFDLENBQUMsZ0JBQWdCLENBQUE7SUFFcEYsT0FBTyxhQUFhLENBQUMsYUFBYSxDQUFDLEtBQUssQ0FBQyxZQUFZLEVBQUUsS0FBSyxDQUFDLGlCQUFpQixJQUFJLEVBQUUsRUFBRTtRQUNwRjtZQUNFLFdBQVcsRUFBRSwwQ0FBa0IsQ0FBQyxVQUFVO1lBQzFDLE9BQU8sRUFBRSxvQ0FBb0MsSUFBSSxFQUFFO1NBQ3BEO0tBQ0YsQ0FBQyxDQUFBO0FBQ0osQ0FBQyxDQUFBO0FBRUQsTUFBTSxnQkFBZ0IsR0FBRyxDQUFDLEtBQTRCLEVBQUUsRUFBRTtJQUN4RCwrQkFBK0I7SUFDL0Isa0dBQWtHO0lBQ2xHLHFFQUFxRTtJQUNyRSwrQkFBK0I7SUFDL0IsT0FBTyxhQUFhLENBQUMsV0FBVyxDQUFDLEtBQUssQ0FBQyxDQUFBO0FBQ3pDLENBQUMsQ0FBQTtBQUNEOzs7OztHQUtHO0FBQ0gsTUFBTSxjQUFjLEdBQUcsQ0FBQyxLQUE0QixFQUFFLEVBQUU7SUFDdEQsT0FBTyw4QkFBOEIsQ0FBQyxLQUFLLENBQUMsQ0FBQTtBQUM5QyxDQUFDLENBQUE7QUFFRCxNQUFNLG9CQUFvQixHQUFHLENBQUMsSUFBVyxFQUFFLEVBQUU7SUFDM0MsT0FBTyxJQUFJLElBQUksSUFBSSxDQUFDLGNBQWMsSUFBSSxJQUFJLENBQUMsY0FBYyxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUE7QUFDdEUsQ0FBQyxDQUFBO0FBRUQsTUFBTSw4QkFBOEIsR0FBRyxDQUFDLEtBQTRCLEVBQUUsRUFBRTtJQUN0RSxNQUFNLGFBQWEsR0FBRyxXQUFXLENBQUMsd0JBQXdCLENBQUMsS0FBSyxFQUFFLFNBQVMsQ0FBQyxDQUFBO0lBQzVFLElBQUksb0JBQW9CLENBQUMsYUFBYSxDQUFDLEVBQUU7UUFDdkMsT0FBTyx1QkFBdUIsQ0FBQyxhQUFhLENBQUMsY0FBYyxFQUFFLEtBQUssQ0FBQyxDQUFBO0tBQ3BFO1NBQU07UUFDTCxPQUFPLGFBQWEsQ0FBQyxXQUFXLENBQUMsS0FBSyxDQUFDLENBQUE7S0FDeEM7QUFDSCxDQUFDLENBQUE7QUFFRCxNQUFNLHVCQUF1QixHQUFHLENBQUMsY0FBd0IsRUFBRSxLQUE0QixFQUFFLEVBQUU7SUFDekYseURBQXlEO0lBQ3pELE1BQU0sb0JBQW9CLEdBQUcsY0FBYyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQTtJQUV4RCxnREFBZ0Q7SUFDaEQsT0FBTyxhQUFhLENBQUMsYUFBYSxDQUNoQyxLQUFLLENBQUMsWUFBWSxFQUNsQixLQUFLLENBQUMsaUJBQWlCLElBQUksRUFBRSxFQUM3QixTQUFTLEVBQ1QsS0FBSyxDQUFDLFlBQVksQ0FBQyxNQUFNLEVBQ3pCO1FBQ0U7WUFDRSxXQUFXLEVBQUUsMENBQWtCLENBQUMsVUFBVTtZQUMxQyxPQUFPLEVBQUUsa0JBQWtCLG9CQUFvQixHQUFHO1NBQ25EO0tBQ0YsQ0FDRixDQUFBO0FBQ0gsQ0FBQyxDQUFBIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSW52b2NhdGlvblNvdXJjZSwgTGV4Q29kZUhvb2tJbnB1dEV2ZW50IH0gZnJvbSBcIi4uLy4uL3NyYy9zaGFyZWRMaWJyYXJpZXMvTGV4Q29kZUhvb2tJbnRlcmZhY2VzXCJcbmltcG9ydCB7IE1lc3NhZ2VDb250ZW50VHlwZSwgVmFsdWUgfSBmcm9tIFwiQGF3cy1zZGsvY2xpZW50LWxleC1ydW50aW1lLXYyXCJcbmltcG9ydCB7IEludGVudE5hbWVzIH0gZnJvbSBcIi4uLy4uL3NyYy9yZW1pbmRlckJvdExleDJMYW1iZGEvaW50ZW50SGFuZGxlcnMvY29uc3RhbnRzXCJcblxuY29uc3QgRGlhbG9nSGVscGVycyA9IHJlcXVpcmUoXCIuLi8uLi9zcmMvc2hhcmVkTGlicmFyaWVzL0RpYWxvZ0hlbHBlcnNcIilcbmNvbnN0IENvbW1vblV0aWxzID0gcmVxdWlyZShcIi4uLy4uL3NyYy9zaGFyZWRMaWJyYXJpZXMvQ29tbW9uVXRpbHNcIilcblxuY29uc3QgVElNRV9TTE9UID0gXCJUaW1lXCJcblxuY29uc3QgVElNRV9TTE9UX1BST01QVF9DT0RFX0hPT0tfTEFCRUwgPSBcIkNhbGxJbnRlbnRfVGltZVNsb3RfUHJvbXB0Q29kZUhvb2tcIlxuY29uc3QgVElNRV9TTE9UX1ZBTElEQVRJT05fQ09ERV9IT09LX0xBQkVMID0gXCJDYWxsSW50ZW50X1RpbWVTbG90X1ZhbGlkYXRpb25Db2RlSG9va1wiXG5cbmV4cG9ydCBmdW5jdGlvbiBoYW5kbGVyKGV2ZW50OiBMZXhDb2RlSG9va0lucHV0RXZlbnQpIHtcbiAgbGV0IHJlc3BvbnNlID0gRGlhbG9nSGVscGVycy5wYXNzVGhyb3VnaChldmVudClcbiAgY29uc3QgaW50ZW50ID0gZXZlbnQuc2Vzc2lvblN0YXRlLmludGVudFxuXG4gIC8vIEB0cy1pZ25vcmUgaW50ZW50IHdpbGwgbmV2ZXIgYmUgdW5kZWZpbmVkIGluIHRoZSBJbnRlbnQgSGFuZGxlclxuICBpZiAoaW50ZW50Lm5hbWUgIT09IEludGVudE5hbWVzLkNBTExfSU5URU5UKSB7XG4gICAgY29uc29sZS5lcnJvcihgV3JvbmcgaGFuZGxlciBmb3IgaW50ZW50IGNhbGxlZCwgY3VycmVudCBpbnRlbnQgaXMgJHtpbnRlbnR9YClcbiAgICAvLyBEZWNpZGUgaG93IHlvdSB3b3VsZCBsaWtlIHRvIGhhbmRsZSB0aGlzIHdpdGggdGhlIGxlYXN0IGRpc3J1cHRpb24gdG8geW91ciB1c2VyXG4gICAgcmV0dXJuIHJlc3BvbnNlXG4gIH1cblxuICAvKipcbiAgICogRGV0ZXJtaW5lIHRoZSBjb3JyZWN0IGxvZ2ljIHRvIHJ1biBiYXNlZCBvbiB3aGF0IGNvZGUgaG9vayB0aGUgcmVxdWVzdCBoYXMgY29tZSBmcm9tXG4gICAqL1xuICBpZiAoZXZlbnQuaW52b2NhdGlvblNvdXJjZSA9PT0gSW52b2NhdGlvblNvdXJjZS5ESUFMT0dfQ09ERV9IT09LKSB7XG4gICAgaWYgKGV2ZW50Lmludm9jYXRpb25MYWJlbCA9PT0gVElNRV9TTE9UX1BST01QVF9DT0RFX0hPT0tfTEFCRUwpIHtcbiAgICAgIC8vIENoZWNrIHRoZSB1c2VyIGlucHV0LCBzbyB3ZSBjYW4gYWRqdXN0IHRoZSBwcm9tcHQgZm9yIGFtYmlndW91cyBvciB0aW1lIHBlcmlvZCB2YWx1ZXNcbiAgICAgIHJlc3BvbnNlID0gY2hlY2tVc2VySW5wdXQoZXZlbnQpXG4gICAgfSBlbHNlIGlmIChldmVudC5pbnZvY2F0aW9uTGFiZWwgPT09IFRJTUVfU0xPVF9WQUxJREFUSU9OX0NPREVfSE9PS19MQUJFTCkge1xuICAgICAgLy8gZmluYWwgdmFsaWRhdGlvbiBvbiBzbG90XG4gICAgICByZXNwb25zZSA9IHZhbGlkYXRlVGltZVNsb3QoZXZlbnQpXG4gICAgfVxuICB9IGVsc2UgaWYgKGV2ZW50Lmludm9jYXRpb25Tb3VyY2UgPT09IEludm9jYXRpb25Tb3VyY2UuRlVMRklMTE1FTlRfQ09ERV9IT09LKSB7XG4gICAgLy8gYm9vayB0aGUgY2FsbFxuICAgIHJlc3BvbnNlID0gZnVsZmlsSW50ZW50KGV2ZW50KVxuICB9XG5cbiAgcmV0dXJuIHJlc3BvbnNlXG59XG5cbi8qKlxuICogRm9yIEZ1bGZpbGxtZW50LCB3ZSB3aWxsIHRha2UgYWN0aW9uIG9uIGJvb2sgdGhlIGNhbGwgYW5kIHRoZW4gc2VuZCBhXG4gKiAgcmVzcG9uc2Ugd2l0aCBTdGF0ZSBvZiBGdWxmaWxsZWQgYW5kIGEgRGlhbG9nQWN0aW9uIG9mIENMT1NFXG4gKi9cbmNvbnN0IGZ1bGZpbEludGVudCA9IChldmVudDogTGV4Q29kZUhvb2tJbnB1dEV2ZW50KSA9PiB7XG4gIC8vICoqKioqKioqKioqKioqKioqKioqKioqKioqKipcbiAgLy8gQUREIExPR0lDIEhFUkUgVE8gQUNUVUFMTFkgQk9PSyBUSEUgQ0FMTCAuLi4uXG4gIC8vXG4gIC8vIElOIFRIRSBSRUFMIFdPUkxEIFdFIFdPVUxEIEJFIFJFQUNISU5HIE9VVCBUTyBFWFRFUk5BTCBTWVNURU1TIEhFUkVcbiAgLy8gRk9SIE5PVyBXRSdSRSBKVVNUIEdPSU5HIFRPIFJFU1BPTkQgQVMgSUYgV0UgRElEIEJPT0sgVEhFIENBTExcbiAgLy8gKioqKioqKioqKioqKioqKioqKioqKioqKioqKipcblxuICBjb25zdCB0aW1lID0gQ29tbW9uVXRpbHMuZ2V0U2Vzc2lvblN0YXRlU2xvdFZhbHVlKGV2ZW50LCBUSU1FX1NMT1QpLmludGVycHJldGVkVmFsdWVcblxuICByZXR1cm4gRGlhbG9nSGVscGVycy5mdWxmaWxsSW50ZW50KGV2ZW50LnNlc3Npb25TdGF0ZSwgZXZlbnQucmVxdWVzdEF0dHJpYnV0ZXMgfHwge30sIFtcbiAgICB7XG4gICAgICBjb250ZW50VHlwZTogTWVzc2FnZUNvbnRlbnRUeXBlLlBMQUlOX1RFWFQsXG4gICAgICBjb250ZW50OiBgWW91ciBjYWxsIGhhcyBiZWVuIHNjaGVkdWxlZCBmb3IgJHt0aW1lfWAsXG4gICAgfSxcbiAgXSlcbn1cblxuY29uc3QgdmFsaWRhdGVUaW1lU2xvdCA9IChldmVudDogTGV4Q29kZUhvb2tJbnB1dEV2ZW50KSA9PiB7XG4gIC8vICoqKioqKioqKioqKioqKioqKioqKioqKioqKipcbiAgLy8gTE9HSUMgQ09VTEQgQkUgQURERUQgSEVSRSBUTyBDSEVDSyBUSElTIFRJTUUgSVMgQVZBSUxBQkxFIEJZIFJFQUNISU5HIE9VVCBUTyBPVVIgQk9PS0lORyBTWVNURU1cbiAgLy8gVEhJUyBXT1VMRCBBTExPVyBVUyBUTyBSRS1QUk9NUFQgVEhFIFVTRVIgRk9SIEEgTkVXIFRJTUUgSUYgTkVFREVEXG4gIC8vICoqKioqKioqKioqKioqKioqKioqKioqKioqKipcbiAgcmV0dXJuIERpYWxvZ0hlbHBlcnMucGFzc1Rocm91Z2goZXZlbnQpXG59XG4vKipcbiAqIE9uIGVhY2ggZWxpY2l0YXRpb24gd2l0aGluIHRoZSBUaW1lIFNsb3Qgd2Ugd2lsbCBkbyB0aGUgZm9sbG93aW5nOlxuICogLSBJZiB0aGUgc2xvdCBpcyBOT1QgZmlsbGVkIHdlIHdpbGwgY2hlY2sgaWYgdGhlcmUgaXMgbW9yZSB0aGFuIG9uZSByZXNvbHZlZCB2YWx1ZVxuICogICAgIC0gSWYgdGhlcmUgaXMgbW9yZSB0aGFuIG9uZSwgd2Ugd2lsbCB1c2UgdGhvc2UgdG8gYXNrIHRoZSB1c2VyIHRvIGNsYXJpZnkgd2l0aCBvbmVcbiAqICAgICAtIEVsc2Ugd2Ugd2lsbCBqdXN0IGRlbGVnYXRlIGJhY2sgdG8gTGV4XG4gKi9cbmNvbnN0IGNoZWNrVXNlcklucHV0ID0gKGV2ZW50OiBMZXhDb2RlSG9va0lucHV0RXZlbnQpID0+IHtcbiAgcmV0dXJuIGNoZWNrRm9yQW1iaWd1b3VzVGltZVNsb3RWYWx1ZShldmVudClcbn1cblxuY29uc3QgaXNBbWJpZ3VvdXNTbG90VmFsdWUgPSAoc2xvdDogVmFsdWUpID0+IHtcbiAgcmV0dXJuIHNsb3QgJiYgc2xvdC5yZXNvbHZlZFZhbHVlcyAmJiBzbG90LnJlc29sdmVkVmFsdWVzLmxlbmd0aCA+IDFcbn1cblxuY29uc3QgY2hlY2tGb3JBbWJpZ3VvdXNUaW1lU2xvdFZhbHVlID0gKGV2ZW50OiBMZXhDb2RlSG9va0lucHV0RXZlbnQpID0+IHtcbiAgY29uc3QgdGltZVNsb3RWYWx1ZSA9IENvbW1vblV0aWxzLmdldFNlc3Npb25TdGF0ZVNsb3RWYWx1ZShldmVudCwgVElNRV9TTE9UKVxuICBpZiAoaXNBbWJpZ3VvdXNTbG90VmFsdWUodGltZVNsb3RWYWx1ZSkpIHtcbiAgICByZXR1cm4gYXNrRm9yVGltZUNsYXJpZmljYXRpb24odGltZVNsb3RWYWx1ZS5yZXNvbHZlZFZhbHVlcywgZXZlbnQpXG4gIH0gZWxzZSB7XG4gICAgcmV0dXJuIERpYWxvZ0hlbHBlcnMucGFzc1Rocm91Z2goZXZlbnQpXG4gIH1cbn1cblxuY29uc3QgYXNrRm9yVGltZUNsYXJpZmljYXRpb24gPSAocmVzb2x2ZWRWYWx1ZXM6IHN0cmluZ1tdLCBldmVudDogTGV4Q29kZUhvb2tJbnB1dEV2ZW50KSA9PiB7XG4gIC8vIGNvbmNhdGVuYXRlIHRoZSByZXNvbHZlZCB2YWx1ZXMgd2l0aCAnb3InIGJldHdlZW4gdGhlbVxuICBjb25zdCByZXNvbHZlZFZhbHVlc1N0cmluZyA9IHJlc29sdmVkVmFsdWVzLmpvaW4oXCIgb3IgXCIpXG5cbiAgLy8gc2V0IHRoZSBuZXh0IHN0ZXAgdG8gYSByZS1wcm9tcHQgZm9yIHRoZSBzbG90XG4gIHJldHVybiBEaWFsb2dIZWxwZXJzLnByb21wdEZvclNsb3QoXG4gICAgZXZlbnQuc2Vzc2lvblN0YXRlLFxuICAgIGV2ZW50LnJlcXVlc3RBdHRyaWJ1dGVzIHx8IHt9LFxuICAgIFRJTUVfU0xPVCxcbiAgICBldmVudC5zZXNzaW9uU3RhdGUuaW50ZW50LFxuICAgIFtcbiAgICAgIHtcbiAgICAgICAgY29udGVudFR5cGU6IE1lc3NhZ2VDb250ZW50VHlwZS5QTEFJTl9URVhULFxuICAgICAgICBjb250ZW50OiBgV291bGQgeW91IGxpa2UgJHtyZXNvbHZlZFZhbHVlc1N0cmluZ30/YCxcbiAgICAgIH0sXG4gICAgXVxuICApXG59XG4iXX0=